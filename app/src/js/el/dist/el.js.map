{"version":3,"file":"el.js","sources":["../src/index.js"],"sourcesContent":["/* jshint esversion:6 */\nexport {el};\n\nconst config = {\n  listeners: [],\n  observer: null,\n  debug: true\n};\n\nfunction el(type, ...opt) {\n  var item;\n  /**\n   * Global listener\n   */\n  if (!config.observer) {\n    config.observer = create_observer();\n  }\n\n  /**\n   * Create element\n   */\n  var elOut = document.createElement(type);\n\n  /**\n   * Compute options\n   */\n  opt.forEach((o) => {\n    /**\n     * Object part el(\"div\",{Object})\n     */\n    if (isObject(o) && !isArray(o)) {\n      Object.keys(o).forEach((a) => {\n        item = o[a];\n        if (\n          a === 'on' &&\n          isArray(item) &&\n          isString(item[0]) &&\n          isFunction(item[1])\n        ) {\n          elOut.addEventListener(item[0], item[1]);\n          config.listeners.push({\n            target: elOut,\n            type: item[0],\n            listener: item[1]\n          });\n        } else if (a === 'on' && isObject(item)) {\n          Object.keys(item).forEach((i) => {\n            if (isFunction(item[i])) {\n              elOut.addEventListener(i, item[i]);\n              config.listeners.push({\n                target: elOut,\n                type: i,\n                listener: item[i]\n              });\n            }\n          });\n        } else if (a === 'innerText' && isString(item)) {\n          elOut.innerText = item;\n        } else if ((a === 'dataset' || a === 'style') && isObject(item)) {\n          Object.keys(item).forEach((i) => {\n            elOut[a][i] = item[i];\n          });\n        } else if (a === 'class' && isArray(item)) {\n          item.forEach((c) => elOut.classList.add(c));\n        } else {\n          elOut.setAttribute(a, o[a]);\n        }\n      });\n    }\n    /**\n     * Array part el(\"div\",[Array])\n     */\n    if (isArray(o)) {\n      o.forEach((elChildren) => {\n        if (isElement(elChildren)) {\n          elOut.appendChild(elChildren);\n        }\n      });\n    }\n    /**\n     * Element part el(\"div\",>Element>)\n     */\n    if (isElement(o)) {\n      elOut.appendChild(o);\n    }\n    /**\n     * HTML part el(\"div\",>Element>)\n     */\n    if (isPromise(o)) {\n      o.then(setContent);\n    } else {\n      setContent(o);\n    }\n  });\n\n  return elOut;\n\n  function setContent(str) {\n    if (isHTML(str) || type === 'style') {\n      elOut.innerHTML = str;\n    } else if (isString(str)) {\n      elOut.innerText = str;\n    }\n  }\n}\n\n/**\n * Test if entry is an aray\n * @param {Array} item\n */\nfunction isObject(item) {\n  return !!item && typeof item === 'object' && !Array.isArray(item);\n}\n\n/**\n * Test if entry is an aray\n * @param {Array} item array\n */\nfunction isArray(item) {\n  return !!item && typeof item === 'object' && Array.isArray(item);\n}\n\n/**\n * Test if string contain HTML\n * @param {String} str string to test\n * @note https://stackoverflow.com/questions/15458876/check-if-a-string-is-html-or-not#answer-36773193\n */\nfunction isHTML(str) {\n  return isString(str) && /(<([^>]+)>)/i.test(str);\n}\n\n/**\n * Test if it's a promise\n * @param {Promise} prom Promise to test\n */\nfunction isPromise(prom) {\n  return prom instanceof Promise;\n}\n\n/**\n * Test if entry is string\n * @param {String} str string to test\n */\nfunction isString(str) {\n  return typeof str === 'string';\n}\n/**\n * Test if entry is function\n * @param {Function} fun Function to test\n */\nfunction isFunction(fun) {\n  return fun instanceof Function;\n}\n\n/**\n * Check if an object is a html element\n * @param {Object} obj object to test\n */\nfunction isElement(obj) {\n  return obj instanceof Element;\n}\n\n/**\n * Automatically remove listeners\n */\n\nfunction create_observer() {\n  const observer = new MutationObserver((m) => {\n    let start = performance.now();\n    let hadChildRemoved = false;\n    let hadFoundListener = false;\n    let nListenersRemoved = 0;\n    let nNodeRemoved = 0;\n    for (let mutation of m) {\n      if (mutation.type === 'childList') {\n        let nNodeRemovedMutation = mutation.removedNodes.length;\n        if (nNodeRemovedMutation) {\n          hadChildRemoved = true;\n          nNodeRemoved = nNodeRemoved + nNodeRemovedMutation;\n          /*\n           * Inspect removed nodes\n           */\n          for (let node of mutation.removedNodes) {\n            /*\n             * Search for registered listeners\n             */\n            for (let l of config.listeners) {\n              if (node.contains(l.target) && l.type && l.listener) {\n                hadFoundListener = true;\n                l.target.removeEventListener(l.type, l.listener);\n                l._to_remove = true;\n              }\n            }\n          }\n\n          /*\n           * Remove found listeners\n           */\n          if (hadFoundListener) {\n            let n = config.listeners.length;\n            while (n--) {\n              if (config.listeners[n]._to_remove === true) {\n\n                nListenersRemoved ++;\n                config.listeners.splice(n, 1);\n              }\n            }\n          }\n        }\n      }\n    }\n    /*\n     * Debug log\n     */\n    if (hadChildRemoved && config.debug) {\n      const diff = performance.now() - start;\n      if (diff > 10) {\n        console.warn(`el observer performance issue.\n          It took ${Math.round(diff)} ms to finish. \n          Number of listeners removed : ${nListenersRemoved}. \n          Number of listeners left: ${config.listeners.length}. \n          Number of removed nodes : ${nNodeRemoved}`);\n      }\n    }\n  });\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n  return observer;\n}\n"],"names":["config","listeners","observer","debug","isObject","item","Array","isArray","isString","str","isFunction","fun","Function","isElement","obj","Element","type","MutationObserver","m","start","performance","now","hadChildRemoved","hadFoundListener","nListenersRemoved","nNodeRemoved","let","mutation","nNodeRemovedMutation","removedNodes","length","node","l","contains","target","listener","removeEventListener","_to_remove","n","splice","diff","console","warn","Math","round","observe","document","body","childList","subtree","elOut","createElement","opt","forEach","o","Object","keys","a","addEventListener","push","i","innerText","c","classList","add","setAttribute","elChildren","appendChild","Promise","then","setContent","test","isHTML","innerHTML"],"mappings":"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"}